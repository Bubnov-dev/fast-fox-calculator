$(document).ready((function(e){const a=document.querySelectorAll(".calculator__info"),t=document.querySelectorAll(".calculator__info-tooltip");for(let e=0;e<a.length;e++){let s=a[e],i=t[e],n=Popper.createPopper(s,i,{modifiers:[{name:"offset",options:{offset:[0,8]}}]});function l(){i.setAttribute("data-show",""),n.update()}function c(){i.removeAttribute("data-show")}let r=["mouseleave","blur"];["mouseenter","focus"].forEach(e=>{s.addEventListener(e,l)}),r.forEach(e=>{s.addEventListener(e,c)})}document.querySelectorAll(".custom-select").forEach(a=>{let t=new Choices(a,{searchEnabled:!1,itemSelectText:"",placeholder:!0,placeholderValue:"none"});e(".calculator__result-reset").on("click",(function(){console.log(t),e(".calculator__form input").removeAttr("disabled"),e(".calculator__form option").removeAttr("disabled"),t.setChoiceByValue("")}))}),input=e(".gerber-file"),input.on("change",(function(a){if(input[0].files[0].size>1e7)input.val("");else{var t="";"zip"==(t=e(this)[0].files&&e(this)[0].files.length>1?(this.getAttribute("data-multiple-caption")||"").replace("{count}",this.files.length):a.target.value.split("\\").pop()).split(".").pop()?e("#gerber-subtitle").html(t):input.val("")}}));let s=new Map([["materials",new Map([["FR-4",1],["alu",1.15]])],["layers",new Map([["1",1],["2",1.2],["4",1.8],["6",2.5]])],["designs",new Map([["1",1],["2",1.2],["3",1.8],["4",2.5]])],["width-plate",new Map([["0.4",1],["0.6",1.2],["0.8",1.8],["1.0",2.5]])],["finish",new Map([["HASL",1],["LFHASL",1.2],["ENIG",1.8]])],["width-cu",new Map([["35",1],["70",1.2]])]]),i=[[5,10],[10,9],[20,8],[30,7],[50,6],[80,5],[100,3],[500,1.8],[1e3,1.7],[2e3,1.6],[3e3,1.5],[5e3,1.4]],n=new Map([["0.4",1],["0.6",1.35],["0.8",1.8],["1.0",2.2],["1.2",2.7],["1.6",3.5],["2.0",4.4]]),r=new Map([["0.8",2.5],["1.0",3.125],["1.2",3.75],["1.6",4.5],["2.0",5.6]]);jQuery.expr[":"].regex=function(e,a,t){var l=t[3].split(","),c=/^(data|css):/,s={method:l[0].match(c)?l[0].split(":")[0]:"attr",property:l.shift().replace(c,"")};return new RegExp(l.join("").replace(/^\s+|\s+$/g,""),"ig").test(jQuery(e)[s.method](s.property))};let o=!0;function d(){console.log("none disabled!"),e(".calculator__form input").removeAttr("disabled"),e("*").removeClass("wrong"),e(".checkForm").addClass("hidden"),"alu"==e('[name="materials"]:checked').val()&&(e('[name="layers"]:regex(value, 2|4|6)').attr("disabled","disabled"),e('[name="width-plate"]:regex(value, 0.4|0.6|0.8|2.0)').attr("disabled","disabled"),e('[name="color-mask"]:regex(value, purple|red|yellow|blue)').attr("disabled","disabled"),e('[name="finish"]:regex(value, ENIG)').attr("disabled","disabled"),e('[name="width-cu"]:regex(value, 70)').attr("disabled","disabled")),"1"==e('[name="layers"]:checked').val()&&(e('[name="width-plate"]:regex(value, 0.4|0.6|0.8)').attr("disabled","disabled"),e('[name="color-mask"]:regex(value, purple)').attr("disabled","disabled"),e('[name="width-cu"]:regex(value, 70)').attr("disabled","disabled")),"4"==e('[name="layers"]:checked').val()&&(e('[name="width-plate"]:regex(value, 0.4|0.6)').attr("disabled","disabled"),e('[name="width-cu"]:regex(value, 70)').attr("disabled","disabled")),"6"==e('[name="layers"]:checked').val()&&(e('[name="width-plate"]:regex(value, 0.4|0.6|0.8|1.0)').attr("disabled","disabled"),e('[name="color-mask"]:regex(value, purple)').attr("disabled","disabled")),"service"==e('[name="panels"]').val()&&(e('[name="designs"]:regex(value, [2-9])').attr("disabled","disabled"),e('[name="width-plate"]:regex(value, 0.4)').attr("disabled","disabled")),-1==e.inArray(e('[name="panels"]').val(),["client","service"])?(e("input:regex(name, numX|numY)").attr("disabled","disabled"),e(".calculator__plats .calculator__form-item-title").html("Количество плат")):e(".calculator__plats .calculator__form-item-title").html("Количество панелей"),-1!=e.inArray(e('[name="width-plate"]:checked').val(),["0.4","0.6","0.8","1.0","1.2"])&&e('[name="width-cu"]:regex(value, 70)').attr("disabled","disabled"),-1!=e.inArray(e('[name="width-plate"]:checked').val(),["0.4","0.6"])&&e('[name="layers"]:regex(value, 1|4|6)').attr("disabled","disabled"),-1!=e.inArray(e('[name="width-plate"]:checked').val(),["0.4"])&&(e('[name="finish"]:regex(value, LFHASL|ENIG)').attr("disabled","disabled"),e('[name="color-mask"]:regex(value, red|yellow)').attr("disabled","disabled")),"purple"==e('[name="color-mask"]:checked').val()&&(e('[name="width-plate"]:regex(value, 0.4|0.6)').attr("disabled","disabled"),e('[name="layers"]:regex(value, 1|6)').attr("disabled","disabled")),-1!=e.inArray(e('[name="color-mask"]:checked').val(),["red","yellow"])&&e('[name="width-plate"]:regex(value, 0.4)').attr("disabled","disabled"),"black"==e('[name="color-mask"]:checked').val()&&e('[name="width-cu"]:regex(value, 70)').attr("disabled","disabled"),"white"==e('[name="color-mask"]:checked').val()?e("#sh-color-black").prop("checked",!0):e("#sh-color-white").prop("checked",!0),e("[disabled]").prop("checked",!1),u();let a=new Set;e('input[type="radio"]').each((function(){a.add(e(this).attr("name"))})),a.forEach((a,t,l)=>{let c=e("input[name="+a+"]:not([disabled])");1==c.length&&c.prop("checked",!0)}),o?(o=!1,d()):o=!0}function u(){let a=1;e("input:checked").each((function(){let t=e(this),l=s.get(e(this).attr("name"));l&&l.get(t.attr("value"))&&(a*=l.get(t.attr("value")))})),console.log("cf = "+a);let t,l=1,c=e("#numX").val()*e("#numY").val();0==c&&(c=1),l=e("#width").val()*e("#height").val()/1e4*e('[name="panels-num"]').val()*c,e(".calculator__resul-S .calculator__result-value").html((l/100).toFixed(2)),console.log("plats "+c+" - "+e("#numX").val()+" - "+e("#numX").val()),t="alu"==e('[name="materials"]:checked').val()?r.get(e('[name="width-plate"]:checked').val())*l/100:n.get(e('[name="width-plate"]:checked').val())*l/100,isNaN(t)&&(console.log("weight is nan"),t=0),e(".calculator__result-weight .calculator__result-value").html(t.toFixed(2));let o=[i[0][1]];for(let e=0;e<i.length;e++)i[e][0]>l&&(o=i[e][1],e=i.length);let d=1;e.getJSON("https://www.cbr-xml-daily.ru/daily_json.js",(function(t){d=t.Valute.USD.Value,console.log(d);let c=o*a*l,s=c*d;e(".calculator__result-price-dollar .calculator__result-value").html(Math.ceil(c)),e(".calculator__result-price-rub .calculator__result-value").html(Math.ceil(s))}))}function h(){e(".calculator__step").addClass("hidden"),console.log(".calculator__step-"+e('[name="progress"]:checked').val()),e(".calculator__step-"+e('[name="progress"]:checked').val()).removeClass("hidden"),2==e('[name="progress"]:checked').val()?e("#back-btn").removeClass("hidden"):e("#back-btn").addClass("hidden"),3==e('[name="progress"]:checked').val()?e("#new-btn").removeClass("hidden"):e("#new-btn").addClass("hidden")}e("#stencil").prop("checked",!1),d(),e(".calculator__step input, .calculator__step select, .calculator__step textarea").on("change",(function(){d()})),e('.calculator__step-1 input[type="text"]').on("keyup",(function(){let a=e(this).val();a=a.replace(/[^0-9]/g,""),e(this).val(a),u()})),e(".calculator__result-reset").on("click",(function(){e("input").prop("checked",!1),e(".calculator__form input").removeAttr("disabled"),e(".calculator__form option").removeAttr("disabled"),e("input, textarea, select").val("")})),e("#stencil").on("change",(function(){e(this).is(":checked")?e(".calculator__stencil").removeClass("hidden"):e(".calculator__stencil").addClass("hidden")})),e("input.email").inputmask({mask:"*{3,20}@*{3,20}.*{2,7}"}),e("input.phone").inputmask({mask:"+7 (999) 999-99-99"}),e("input.plain-text-input").inputmask({mask:"a{1,20}"}),h(),e('[name="progress"]').on("change",(function(){h()})),e("#back-btn").on("click",(function(){e("#progress-1").prop("checked",!0),h()})),e("#order-1, #progress-2 + label").on("click",(function(){!function(){let a=new Set,t=new Set,l=new Set,c=new Set,s=!1;return e(".calculator__main input:not(#stencil), .calculator__main select, .calculator__main textarea").each((function(){e(this).is(":not([disabled])")&&a.add(e(this).attr("name"))})),e(".calculator__main input:not(#stencil)").each((function(){(e(this).is('[type="radio"]:checked')||e(this).is('[type="text"],[type="file"]')&&""!=e(this).val())&&t.add(e(this).attr("name"))})),e(".calculator__main select, .calculator__main textarea").each((function(){""!=e(this).val()&&t.add(e(this).attr("name"))})),e("#stencil").is(":checked")&&(e(".calculator__stencil input:not(#stencil), .calculator__stencil select, .calculator__stencil textarea").each((function(){e(this).is(":not([disabled])")&&l.add(e(this).attr("name"))})),e(".calculator__stencil input:not(#stencil)").each((function(){(e(this).is('[type="radio"]:checked')||e(this).is('[type="text"],[type="file"]')&&""!=e(this).val())&&c.add(e(this).attr("name"))})),e(".calculator__stencil select, .calculator__stencil textarea").each((function(){""!=e(this).val()&&c.add(e(this).attr("name"))}))),a.size==t.size&&l.size==c.size?s=!0:(e("#checkForm1").removeClass("hidden"),a.forEach(a=>{t.has(a)||(e("[name="+a+"]").is("select")?e("[name="+a+"]").parent(".choices__inner").addClass("wrong"):e("[name="+a+"]").addClass("wrong"))}),l.forEach(a=>{c.has(a)||(e("[name="+a+"]").is("select")?e("[name="+a+"]").parent(".choices__inner").addClass("wrong"):e("[name="+a+"]").addClass("wrong"))})),console.log(a),console.log(t),console.log(l),console.log(c),console.log(s),s}()||e("#progress-3").is(":checked")?e("#progress-2").attr("disabled","disabled"):(e("#progress-2").removeAttr("disabled"),e("#progress-2").prop("checked",!0),h())})),e("#order-2").on("click",(function(){(function(){let a=new Set,t=new Set,l=!1;return e(".calculator__step-2 input:not(#mail-check, #user-promo), .calculator__step-2 select, .calculator__step-2 textarea").each((function(){e(this).is(":not([disabled])")&&a.add(e(this).attr("name"))})),e(".calculator__step-2 input:not(#mail-check, #user-promo)").each((function(){(e(this).is(":checked")||e(this).is('[type="text"],[type="file"]')&&""!=e(this).val()&&e(this).inputmask("isComplete"))&&t.add(e(this).attr("name"))})),e(".calculator__step-2 select, .calculator__step-2 textarea").each((function(){""!=e(this).val()&&t.add(e(this).attr("name"))})),a.size==t.size?l=!0:(e("#checkForm2").removeClass("hidden"),a.forEach(a=>{t.has(a)||(e("[name="+a+"]").is("select")?e("[name="+a+"]").parent(".choices__inner").addClass("wrong"):e("[name="+a+"]").addClass("wrong"))})),l})()&&e("#data-check").is(":checked")&&(e("#progress-3").prop("checked",!0),h(),e("#progress-1").prop("disabled","disabled"),e("#progress-2").prop("disabled","disabled"))}))}));