$(document).ready((function(e){e(".calculator__form input").removeAttr("disabled"),e('.calculator__step input[type="text"], .calculator__step textarea, .calculator__step select:not([name="panels"]').val("");const a=document.querySelectorAll(".calculator__info"),t=document.querySelectorAll(".calculator__info-tooltip");for(let e=0;e<a.length;e++){let s=a[e],n=t[e],c=Popper.createPopper(s,n,{modifiers:[{name:"offset",options:{offset:[0,8]}}]});function l(){n.setAttribute("data-show",""),c.update()}function i(){n.removeAttribute("data-show")}let r=["mouseleave","blur"];["mouseenter","focus"].forEach(e=>{s.addEventListener(e,l)}),r.forEach(e=>{s.addEventListener(e,i)})}let s;const n=()=>{e('.custom-select:not([name="panels" ])').each((function(){let a=new Choices(e(this)[0],{searchEnabled:!1,itemSelectText:"",placeholder:!0,placeholderValue:"none"});e(".calculator__result-reset").on("click",(function(){e(".calculator__form input").removeAttr("disabled"),e(".calculator__form option").removeAttr("disabled"),a.setChoiceByValue("")}))})),s=new Choices(e('[name="panels"]')[0],{searchEnabled:!1,itemSelectText:"",placeholder:!0,placeholderValue:"none"}),e(".calculator__result-reset").on("click",(function(){e(".calculator__form input").removeAttr("disabled"),e(".calculator__form option").removeAttr("disabled"),s.setChoiceByValue("")}))};n(),inputs=e(".gerber-file"),inputs.each((function(){e(this).on("change",(function(a){let t=e(this);if(t.parent().find(".wrong-file").addClass("hidden"),t[0].files[0].size>1e7)t.val(""),t.parent().find(".wrong-file").removeClass("hidden"),console.log(t.parent().find(".calculator__form-item-subtitle")),t.parent().find(".calculator__form-item-subtitle").html('<div class="wrong-file">Неверный тип или размер файла</div>Только .zip максимум 10МБ');else{var l="";"zip"==(l=e(this)[0].files&&e(this)[0].files.length>1?(this.getAttribute("data-multiple-caption")||"").replace("{count}",this.files.length):a.target.value.split("\\").pop()).split(".").pop()?thiss.parent().find(".calculator__form-item-subtitle").html(l):(t.val(""),thiss.parent().find(".wrong-file").removeClass("hidden"),thiss.parent().find(".calculator__form-item-subtitle").html('<div class="wrong-file">Неверный тип или размер файла</div>Только .zip максимум 10МБ'))}}))}));let c=new Map([["materials",new Map([["FR-4",1],["alu",1.15]])],["layers",new Map([["1",1],["2",1.2],["4",1.8],["6",2.5]])],["designs",new Map([["1",1],["2",1.2],["3",1.8],["4",2.5]])],["width-plate",new Map([["0.4",1],["0.6",1.2],["0.8",1.8],["1.0",2.5]])],["finish",new Map([["HASL",1],["LFHASL",1.2],["ENIG",1.8]])],["width-cu",new Map([["35",1],["70",1.2]])]]),r=[[5,10],[10,9],[20,8],[30,7],[50,6],[80,5],[100,3],[500,1.8],[1e3,1.7],[2e3,1.6],[3e3,1.5],[5e3,1.4]],d=new Map([["0.4",1],["0.6",1.35],["0.8",1.8],["1.0",2.2],["1.2",2.7],["1.6",3.5],["2.0",4.4]]),o=new Map([["0.8",2.5],["1.0",3.125],["1.2",3.75],["1.6",4.5],["2.0",5.6]]);jQuery.expr[":"].regex=function(e,a,t){var l=t[3].split(","),i=/^(data|css):/,s={method:l[0].match(i)?l[0].split(":")[0]:"attr",property:l.shift().replace(i,"")};return new RegExp(l.join("").replace(/^\s+|\s+$/g,""),"ig").test(jQuery(e)[s.method](s.property))};let u=!0;function h(){let a=s.getValue().value;if(s.destroy(),e("option").removeAttr("disabled"),n(),s.setChoiceByValue(a),console.log(e('[name="materials"]:checked').val()),e(".calculator__form input").removeAttr("disabled"),e("*").removeClass("wrong"),e(".checkForm").addClass("hidden"),"alu"==e('[name="materials"]:checked').val()&&(console.log("alu"),e('[name="layers"]:regex(value, 2|4|6)').attr("disabled","disabled"),e('[name="width-plate"]:regex(value, 0.4|0.6|0.8|2.0)').attr("disabled","disabled"),e('[name="color-mask"]:regex(value, purple|red|yellow|blue)').attr("disabled","disabled"),e('[name="finish"]:regex(value, ENIG)').attr("disabled","disabled"),e('[name="width-cu"]:regex(value, 70)').attr("disabled","disabled")),"1"==e('[name="layers"]:checked').val()&&(e('[name="width-plate"]:regex(value, 0.4|0.6)').attr("disabled","disabled"),e('[name="color-mask"]:regex(value, purple)').attr("disabled","disabled"),e('[name="width-cu"]:regex(value, 70)').attr("disabled","disabled")),"4"==e('[name="layers"]:checked').val()&&(e('[name="width-plate"]:regex(value, 0.4|0.6)').attr("disabled","disabled"),e('[name="width-cu"]:regex(value, 70)').attr("disabled","disabled")),"6"==e('[name="layers"]:checked').val()&&(e('[name="width-plate"]:regex(value, 0.4|0.6|0.8|1.0)').attr("disabled","disabled"),e('[name="color-mask"]:regex(value, purple)').attr("disabled","disabled")),"service"==e('[name="panels"]').val()&&(e('[name="designs"]:regex(value, [2-9])').attr("disabled","disabled"),e('[name="width-plate"]:regex(value, 0.4)').attr("disabled","disabled")),e('[name="designs"]').val()>1&&(s.destroy(),e('[name="panels"] [value="service"]').attr("disabled","disabled"),e('[name="panels"] [value="separate"]').attr("disabled","disabled"),s=new Choices(e('[name="panels"]')[0],{searchEnabled:!1,itemSelectText:"",placeholder:!0,placeholderValue:"none"}),s.setChoiceByValue("client")),-1==e.inArray(e('[name="panels"]').val(),["client","service"])?(e("input:regex(name, numX|numY)").attr("disabled","disabled"),e("input:regex(name, numX|numY)").val(""),e(".calculator__plats .calculator__form-item-title").html("Количество плат")):(e(".calculator__plats .calculator__form-item-title").html("Количество панелей"),e('[name="designs"]').val()>1&&(e("input:regex(name, numX|numY)").attr("disabled","disabled"),e("input:regex(name, numX|numY)").val(""))),-1!=e.inArray(e('[name="width-plate"]:checked').val(),["0.4","0.6","0.8","1.0","1.2"])&&e('[name="width-cu"]:regex(value, 70)').attr("disabled","disabled"),-1!=e.inArray(e('[name="width-plate"]:checked').val(),["0.4","0.6"])){e('[name="layers"]:regex(value, 1|4|6)').attr("disabled","disabled");let a=s.getValue().value;s.destroy(),e('[name="panels"] [value="service"]').attr("disabled","disabled"),s=new Choices(e('[name="panels"]')[0],{searchEnabled:!1,itemSelectText:"",placeholder:!0,placeholderValue:"none"}),"service"!=a&&s.setChoiceByValue(a)}else{let a=s.getValue().value;s.destroy(),s=new Choices(e('[name="panels"]')[0],{searchEnabled:!1,itemSelectText:"",placeholder:!0,placeholderValue:"none"}),s.setChoiceByValue(a)}-1!=e.inArray(e('[name="width-plate"]:checked').val(),["0.4"])&&(e('[name="finish"]:regex(value, LFHASL|ENIG)').attr("disabled","disabled"),e('[name="color-mask"]:regex(value, red|yellow)').attr("disabled","disabled")),"purple"==e('[name="color-mask"]:checked').val()&&(e('[name="width-plate"]:regex(value, 0.4|0.6)').attr("disabled","disabled"),e('[name="layers"]:regex(value, 1|6)').attr("disabled","disabled")),-1!=e.inArray(e('[name="color-mask"]:checked').val(),["red","yellow"])&&e('[name="width-plate"]:regex(value, 0.4)').attr("disabled","disabled"),"black"==e('[name="color-mask"]:checked').val()&&e('[name="width-cu"]:regex(value, 70)').attr("disabled","disabled"),"white"==e('[name="color-mask"]:checked').val()?e("#sh-color-black").prop("checked",!0):e("#sh-color-white").prop("checked",!0),e("[disabled]").prop("checked",!1),p();let t=new Set;e('input[type="radio"]').each((function(){t.add(e(this).attr("name"))})),t.forEach((a,t,l)=>{let i=e("input[name="+a+"]:not([disabled])");1==i.length&&i.prop("checked",!0)}),u?(u=!1,h()):u=!0}function p(){let a=1;e("input:checked").each((function(){let t=e(this),l=c.get(e(this).attr("name"));l&&l.get(t.attr("value"))&&(a*=l.get(t.attr("value")))}));let t,l=1,i=e("#numX").val()*e("#numY").val();0==i&&(i=1),l=e("#width").val()*e("#height").val()/1e4*e('[name="panels-num"]').val()*i,e(".calculator__resul-S .calculator__result-value").html((l/100).toFixed(2)),t="alu"==e('[name="materials"]:checked').val()?o.get(e('[name="width-plate"]:checked').val())*l/100:d.get(e('[name="width-plate"]:checked').val())*l/100,isNaN(t)&&(t=0),e(".calculator__result-weight .calculator__result-value").html(t.toFixed(2));let s=[r[0][1]];for(let e=0;e<r.length;e++)r[e][0]>l&&(s=r[e][1],e=r.length);let n=1;e.getJSON("https://www.cbr-xml-daily.ru/daily_json.js",(function(t){n=t.Valute.USD.Value;let i=s*a*l,c=i*n;e(".calculator__result-price-dollar .calculator__result-value").html(i.toFixed(2)),e(".calculator__result-price-rub .calculator__result-value").html(Math.ceil(c))}))}function m(){e(".calculator__step").addClass("hidden"),e(".calculator__step-"+e('[name="progress"]:checked').val()).removeClass("hidden"),2==e('[name="progress"]:checked').val()?e("#back-btn").removeClass("hidden"):e("#back-btn").addClass("hidden"),3==e('[name="progress"]:checked').val()?e("#new-btn").removeClass("hidden"):e("#new-btn").addClass("hidden")}e('[name="designs"]').on("change",(function(){nonRecursion=!0})),e("#stencil").prop("checked",!1),h(),e(".calculator__step input, .calculator__step select, .calculator__step textarea").on("change",(function(){h()})),e('.calculator__step-1 input[type="text"]').on("keyup",(function(){let a=e(this).val();a=a.replace(/[^0-9]/g,""),e(this).is("#width")&&a>400&&(a=400),e(this).is("#height")&&a>500&&(a=500),e(this).val(a),p()})),e(".calculator__result-reset").on("click",(function(){e("input").prop("checked",!1),e(".calculator__form input").removeAttr("disabled"),e(".calculator__form option").removeAttr("disabled"),e("input, textarea, select").val("")})),e("#stencil").on("change",(function(){e(this).is(":checked")?e(".calculator__stencil").removeClass("hidden"):e(".calculator__stencil").addClass("hidden")})),e("input.email").inputmask({mask:"*{3,20}@*{3,20}.*{2,7}"}),e("input.phone").inputmask({mask:"+7 (999) 999-99-99"}),e("input.plain-text-input").inputmask({mask:"a{1,20}"}),m(),e('[name="progress"]').on("change",(function(){m()})),e("#back-btn").on("click",(function(){e("#progress-1").prop("checked",!0),m()})),e("#order-1, #progress-2 + label").on("click",(function(){!function(){let a=new Set,t=new Set,l=new Set,i=new Set,s=!1;return e(".calculator__main input:not(#stencil), .calculator__main select").each((function(){e(this).is(":not([disabled])")&&a.add(e(this).attr("name"))})),e(".calculator__main input:not(#stencil)").each((function(){(e(this).is('[type="radio"]:checked')||e(this).is('[type="text"],[type="file"]')&&""!=e(this).val())&&t.add(e(this).attr("name"))})),e(".calculator__main select, .calculator__main textarea").each((function(){""!=e(this).val()&&t.add(e(this).attr("name"))})),e("#stencil").is(":checked")&&(e(".calculator__stencil input:not(#stencil), .calculator__stencil select").each((function(){e(this).is(":not([disabled])")&&l.add(e(this).attr("name"))})),e(".calculator__stencil input:not(#stencil)").each((function(){(e(this).is('[type="radio"]:checked')||e(this).is('[type="text"],[type="file"]')&&""!=e(this).val())&&i.add(e(this).attr("name"))})),e(".calculator__stencil select, .calculator__stencil textarea").each((function(){""!=e(this).val()&&i.add(e(this).attr("name"))}))),a.size==t.size&&l.size==i.size?s=!0:(e("#checkForm1").removeClass("hidden"),a.forEach(a=>{t.has(a)||(e("[name="+a+"]").is("select")?e("[name="+a+"]").parent(".choices__inner").addClass("wrong"):e("[name="+a+"]").addClass("wrong"))}),l.forEach(a=>{i.has(a)||(e("[name="+a+"]").is("select")?e("[name="+a+"]").parent(".choices__inner").addClass("wrong"):e("[name="+a+"]").addClass("wrong"))})),s}()||e("#progress-3").is(":checked")?e("#progress-2").attr("disabled","disabled"):(e("#progress-2").removeAttr("disabled"),e("#progress-2").prop("checked",!0),m())})),e("#order-2").on("click",(function(){if(function(){let a=new Set,t=new Set,l=!1;return e(".calculator__step-2 input:not(#mail-check, #user-promo), .calculator__step-2 select, .calculator__step-2 textarea").each((function(){e(this).is(":not([disabled])")&&a.add(e(this).attr("name"))})),e(".calculator__step-2 input:not(#mail-check, #user-promo)").each((function(){(e(this).is(":checked")||e(this).is('[type="text"],[type="file"]')&&""!=e(this).val()&&e(this).inputmask("isComplete"))&&t.add(e(this).attr("name"))})),e(".calculator__step-2 select, .calculator__step-2 textarea").each((function(){""!=e(this).val()&&t.add(e(this).attr("name"))})),a.size==t.size?l=!0:(e("#checkForm2").removeClass("hidden"),a.forEach(a=>{t.has(a)||(e("[name="+a+"]").is("select")?e("[name="+a+"]").parent(".choices__inner").addClass("wrong"):e("[name="+a+"]").addClass("wrong"))})),l}()&&e("#data-check").is(":checked")){var a=new FormData;if(a.append("gerber-file",e("#gerber-file").prop("files")[0],"newfile.zip"),e.ajax({url:"file.php",type:"POST",data:a,async:!1,success:function(e){b(e,0)},error:function(e){alert("-Ошибка!")},cache:!1,contentType:!1,processData:!1}),e("#stencil").is(":checked")){var t=new FormData;t.append("gerber-file-2",e("#gerber-file-2").prop("files")[0],"newfile-2.zip"),e.ajax({url:"file.php",type:"POST",data:t,async:!1,success:function(e){b(e,1)},error:function(e){alert("-Ошибка!")},cache:!1,contentType:!1,processData:!1})}else b("null",1);e("#progress-3").prop("checked",!0),m(),e("#progress-1").prop("disabled","disabled"),e("#progress-2").prop("disabled","disabled")}}));let _,f,v=0;function b(a,t){0==t?_=a:f=a,0==v?v++:1==v&&function(a,t){let l=new Set,i={};e(".calculator__main input:not(#stencil), .calculator__step-2 input").each((function(){if(e(this).is('[type="radio"]:checked')||e(this).is('[type="text"]')&&""!=e(this).val()&&!e("input").is('[type="file"]')){l.add(e(this).attr("name"));let a=e(this).attr("name");i[a]=e(this).val()}})),e(".calculator__main select, .calculator__main textarea").each((function(){if(""!=e(this).val()){l.add(e(this).attr("name"));let a=e(this).attr("name");i[a]=e(this).val()}})),e("#stencil").is(":checked")&&(e(".calculator__stencil input").each((function(){if(e(this).is('[type="radio"]:checked')||e(this).is('[type="text"]')&&""!=e(this).val()&&!e("input").is('[type="file"]')){l.add(e(this).attr("name"));let a=e(this).attr("name");i[a]=e(this).val()}})),e(".calculator__stencil select, .calculator__stencil textarea").each((function(){if(""!=e(this).val()){l.add(e(this).attr("name"));let a=e(this).attr("name");i[a]=e(this).val()}})));console.log("checkedInputs"),i["gerber-file-main"]=a,i["gerber-file-stencil"]=t,i.price=e(".calculator__result-price-rub .calculator__result-value").html();let s=JSON.stringify(i);console.log(s),e.ajax({url:"formproduct.php",type:"POST",data:{post_data:s},dataType:"json",async:!1,success:function(e){alert(e.value)},error:function(e){alert("Ошибка!")}})}(_,f)}}));