$(document).ready((function(e){const a=document.querySelectorAll(".calculator__info"),l=document.querySelectorAll(".calculator__info-tooltip");for(let e=0;e<a.length;e++){let d=a[e],i=l[e],n=Popper.createPopper(d,i,{modifiers:[{name:"offset",options:{offset:[0,8]}}]});function t(){i.setAttribute("data-show",""),n.update()}function r(){i.removeAttribute("data-show")}let s=["mouseleave","blur"];["mouseenter","focus"].forEach(e=>{d.addEventListener(e,t)}),s.forEach(e=>{d.addEventListener(e,r)})}document.querySelectorAll(".custom-select").forEach(a=>{let l=new Choices(a,{searchEnabled:!1,itemSelectText:"",placeholder:!0,placeholderValue:"none"});e(".calculator__result-reset").on("click",(function(){console.log(l),e("input").removeAttr("disabled"),e("option").removeAttr("disabled"),l.setChoiceByValue("")}))}),input=e(".gerber-file"),input.on("change",(function(a){if(input[0].files[0].size>1e7)input.val("");else{var l="";"zip"==(l=e(this)[0].files&&e(this)[0].files.length>1?(this.getAttribute("data-multiple-caption")||"").replace("{count}",this.files.length):a.target.value.split("\\").pop()).split(".").pop()?e("#gerber-subtitle").html(l):input.val("")}}));let d=new Map([["materials",new Map([["FR-4",1],["alu",1.15]])],["layers",new Map([["1",1],["2",1.2],["4",1.8],["6",2.5]])],["designs",new Map([["1",1],["2",1.2],["3",1.8],["4",2.5]])],["width-plate",new Map([["0.4",1],["0.6",1.2],["0.8",1.8],["1.0",2.5]])],["finish",new Map([["HASL",1],["LFHASL",1.2],["ENIG",1.8]])],["width-cu",new Map([["35",1],["70",1.2]])]]),i=[[5,10],[10,9],[20,8],[30,7],[50,6],[80,5],[100,3],[500,1.8],[1e3,1.7],[2e3,1.6],[3e3,1.5],[5e3,1.4]],n=new Map([["0.4",1],["0.6",1.35],["0.8",1.8],["1.0",2.2],["1.2",2.7],["1.6",3.5],["2.0",4.4]]),s=new Map([["0.8",2.5],["1.0",3.125],["1.2",3.75],["1.6",4.5],["2.0",5.6]]);jQuery.expr[":"].regex=function(e,a,l){var t=l[3].split(","),r=/^(data|css):/,d={method:t[0].match(r)?t[0].split(":")[0]:"attr",property:t.shift().replace(r,"")};return new RegExp(t.join("").replace(/^\s+|\s+$/g,""),"ig").test(jQuery(e)[d.method](d.property))};let c=!0;function o(){e("input").removeAttr("disabled"),"alu"==e('[name="materials"]:checked').val()&&(e('[name="layers"]:regex(value, 2|4|6)').attr("disabled","disabled"),e('[name="width-plate"]:regex(value, 0.4|0.6|0.8|2.0)').attr("disabled","disabled"),e('[name="color-mask"]:regex(value, purple|red|yellow|blue)').attr("disabled","disabled"),e('[name="finish"]:regex(value, ENIG)').attr("disabled","disabled"),e('[name="width-cu"]:regex(value, 70)').attr("disabled","disabled")),"1"==e('[name="layers"]:checked').val()&&(e('[name="width-plate"]:regex(value, 0.4|0.6|0.8)').attr("disabled","disabled"),e('[name="color-mask"]:regex(value, purple)').attr("disabled","disabled"),e('[name="width-cu"]:regex(value, 70)').attr("disabled","disabled")),"4"==e('[name="layers"]:checked').val()&&(e('[name="width-plate"]:regex(value, 0.4|0.6)').attr("disabled","disabled"),e('[name="width-cu"]:regex(value, 70)').attr("disabled","disabled")),"6"==e('[name="layers"]:checked').val()&&(e('[name="width-plate"]:regex(value, 0.4|0.6|0.8|1.0)').attr("disabled","disabled"),e('[name="color-mask"]:regex(value, purple)').attr("disabled","disabled")),"service"==e('[name="panels"]').val()&&(e('[name="designs"]:regex(value, [2-9])').attr("disabled","disabled"),e('[name="width-plate"]:regex(value, 0.4)').attr("disabled","disabled")),-1==e.inArray(e('[name="panels"]').val(),["client","service"])?(e("input:regex(name, numX|numY)").attr("disabled","disabled"),e(".calculator__plats .calculator__form-item-title").html("Количество плат")):e(".calculator__plats .calculator__form-item-title").html("Количество панелей"),-1!=e.inArray(e('[name="width-plate"]:checked').val(),["0.4","0.6","0.8","1.0","1.2"])&&e('[name="width-cu"]:regex(value, 70)').attr("disabled","disabled"),-1!=e.inArray(e('[name="width-plate"]:checked').val(),["0.4","0.6"])&&e('[name="layers"]:regex(value, 1|4|6)').attr("disabled","disabled"),-1!=e.inArray(e('[name="width-plate"]:checked').val(),["0.4"])&&(e('[name="finish"]:regex(value, LFHASL|ENIG)').attr("disabled","disabled"),e('[name="color-mask"]:regex(value, red|yellow)').attr("disabled","disabled")),"purple"==e('[name="color-mask"]:checked').val()&&(e('[name="width-plate"]:regex(value, 0.4|0.6)').attr("disabled","disabled"),e('[name="layers"]:regex(value, 1|6)').attr("disabled","disabled")),-1!=e.inArray(e('[name="color-mask"]:checked').val(),["red","yellow"])&&e('[name="width-plate"]:regex(value, 0.4)').attr("disabled","disabled"),"black"==e('[name="color-mask"]:checked').val()&&e('[name="width-cu"]:regex(value, 70)').attr("disabled","disabled"),"white"==e('[name="color-mask"]:checked').val()?e("#sh-color-black").prop("checked",!0):e("#sh-color-white").prop("checked",!0),e("[disabled]").prop("checked",!1),u();let a=new Set;e('input[type="radio"]').each((function(){a.add(e(this).attr("name"))})),a.forEach((a,l,t)=>{let r=e("input[name="+a+"]:not([disabled])");1==r.length&&r.prop("checked",!0)}),c?(c=!1,o()):c=!0}function u(){let a=1;e("input:checked").each((function(){let l=e(this),t=d.get(e(this).attr("name"));t&&t.get(l.attr("value"))&&(a*=t.get(l.attr("value")))})),console.log("cf = "+a);let l,t=1,r=e("#numX").val()*e("#numY").val();0==r&&(r=1),t=e("#width").val()*e("#height").val()/1e4*e('[name="panels-num"]').val()*r,e(".calculator__resul-S .calculator__result-value").html((t/100).toFixed(2)),console.log("plats "+r+" - "+e("#numX").val()+" - "+e("#numX").val()),l="alu"==e('[name="materials"]:checked').val()?s.get(e('[name="width-plate"]:checked').val())*t/100:n.get(e('[name="width-plate"]:checked').val())*t/100,isNaN(l)&&(console.log("weight is nan"),l=0),e(".calculator__result-weight .calculator__result-value").html(l.toFixed(2));let c=[i[0][1]];for(let e=0;e<i.length;e++)i[e][0]>t&&(c=i[e][1],e=i.length);let o=1;e.getJSON("https://www.cbr-xml-daily.ru/daily_json.js",(function(l){o=l.Valute.USD.Value,console.log(o);let r=c*a*t,d=r*o;e(".calculator__result-price-dollar .calculator__result-value").html(Math.ceil(r)),e(".calculator__result-price-rub .calculator__result-value").html(Math.ceil(d))}))}function p(){e(".calculator__step").addClass("hidden"),console.log(".calculator__step-"+e('[name="progress"]:checked').val()),e(".calculator__step-"+e('[name="progress"]:checked').val()).removeClass("hidden"),2==e('[name="progress"]:checked').val()?e("#back-btn").removeClass("hidden"):e("#back-btn").addClass("hidden"),3==e('[name="progress"]:checked').val()?e("#new-btn").removeClass("hidden"):e("#new-btn").addClass("hidden")}o(),e("input, select").on("change",(function(){o()})),e('.calculator__step-1 input[type="text"]').on("keyup",(function(){let a=e(this).val();a=a.replace(/[^0-9]/g,""),e(this).val(a),u()})),e(".calculator__result-reset").on("click",(function(){e("input").prop("checked",!1),e("input").removeAttr("disabled"),e("option").removeAttr("disabled"),e("input, textarea, select").val("")})),e("#stencil").on("change",(function(){e(this).is(":checked")?e(".calulator__stencil").removeClass("hidden"):e(".calulator__stencil").addClass("hidden")})),e("input.email").inputmask({mask:"*{3,20}@*{3,20}.*{2,7}"}),e("input.phone").inputmask({mask:"+7 (999) 999-99-99"}),e("input.plain-text-input").inputmask({mask:"aa {1,20}"}),p(),e('[name="progress"]').on("change",(function(){p()})),e("#back-btn").on("click",(function(){e("#progress-1").prop("checked",!0),p()})),e("#order-1").on("click",(function(){e("#progress-2").prop("checked",!0),p()})),e("#order-2").on("click",(function(){e("#data-check").is(":checked")&&(e("#progress-3").prop("checked",!0),p(),e("#progress-1").prop("disabled","disabled"),e("#progress-2").prop("disabled","disabled"))}))}));